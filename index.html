<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pakar Diagnosa Penyakit Telinga</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .nav-tabs {
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            padding: 0 20px;
            display: flex;
            gap: 0;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }

        .nav-tab:hover {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }

        .content {
            padding: 40px;
        }

        .page {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .welcome-text {
            text-align: center;
            margin-bottom: 40px;
            color: #333;
            line-height: 1.8;
        }

        .welcome-text h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #4CAF50;
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 3px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .symptoms-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .symptom-counter {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .search-box {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1rem;
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .symptom-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .symptom-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(76, 175, 80, 0.1), transparent);
            transition: all 0.3s ease;
        }

        .symptom-item:hover::before {
            left: 100%;
        }

        .symptom-item:hover {
            border-color: #4CAF50;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .symptom-item.selected {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-color: #4CAF50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            transform: scale(1.02);
        }

        .symptom-checkbox {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4CAF50;
        }

        .symptom-label {
            font-weight: 500;
            color: #333;
            cursor: pointer;
            position: relative;
            z-index: 1;
        }

        .symptom-code {
            color: #666;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .results-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }

        .results-section h3 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selected-symptoms {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196F3;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
        }

        .diagnosis-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .diagnosis-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #ddd;
            transition: all 0.3s ease;
        }

        .diagnosis-item.primary {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%);
            transform: scale(1.02);
        }

        .diagnosis-item.primary::before {
            background: #4CAF50;
            width: 6px;
        }

        .diagnosis-item.high-confidence {
            border-color: #FF9800;
        }

        .diagnosis-item.high-confidence::before {
            background: #FF9800;
        }

        .diagnosis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .disease-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
        }

        .percentage {
            font-weight: bold;
            color: #4CAF50;
            font-size: 1.2rem;
            padding: 5px 12px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 20px;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .disease-info {
            background: rgba(255,255,255,0.7);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.95rem;
            color: #555;
            border-left: 3px solid #4CAF50;
        }

        .solution-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffeaa7;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }

        .solution-box h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .solution-box p {
            color: #856404;
            line-height: 1.8;
            font-size: 1rem;
        }

        .statistics-box {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .stat-item {
            display: inline-block;
            margin: 0 15px;
            padding: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .center {
            text-align: center;
        }

        .mt-30 {
            margin-top: 30px;
        }

        .warning {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            color: #c62828;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #c62828;
            margin: 25px 0;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.2);
        }

        .info-card {
            background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
            border: 2px solid #03a9f4;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(3, 169, 244, 0.2);
        }

        .floating-stats {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                padding: 0 10px;
            }

            .nav-tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .search-box {
                width: 100%;
            }

            .symptoms-header {
                flex-direction: column;
                align-items: stretch;
            }

            .floating-stats {
                position: relative;
                top: auto;
                right: auto;
                margin: 20px 0;
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="floating-stats" id="floating-stats">
        <div class="stat-item">
            <span class="stat-number" id="session-time">0:00</span>
            <span class="stat-label">Waktu Sesi</span>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🩺 Sistem Pakar Diagnosa Penyakit Telinga</h1>
            <p>Sistem bantuan diagnosis berbasis Forward Chaining dengan AI Intelligence</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showHome()" id="tab-home">🏠 Beranda</button>
            <button class="nav-tab" onclick="showInfo()" id="tab-info">ℹ️ Informasi</button>
            <button class="nav-tab" onclick="showConsultation()" id="tab-consultation">🔍 Konsultasi</button>
            <button class="nav-tab" onclick="showStatistics()" id="tab-statistics">📊 Statistik</button>
        </div>
        
        <div class="content">
            <!-- Halaman Beranda -->
            <div id="home-page" class="page active">
                <div class="welcome-text">
                    <h2>🎯 Selamat Datang di Sistem Diagnosa Cerdas</h2>
                    <p>Sistem pakar ini menggunakan teknologi Forward Chaining untuk membantu mendiagnosis penyakit telinga berdasarkan gejala yang Anda alami. Dengan akurasi tinggi dan interface yang user-friendly, kami siap membantu Anda.</p>
                </div>

                <div class="features-grid">
                    <div class="feature-card">
                        <span class="feature-icon">🧠</span>
                        <h3>AI Forward Chaining</h3>
                        <p>Menggunakan algoritma cerdas untuk menganalisis gejala dan memberikan diagnosis yang akurat</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">⚡</span>
                        <h3>Diagnosis Cepat</h3>
                        <p>Hasil diagnosis dalam hitungan detik dengan analisis mendalam</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">🎯</span>
                        <h3>Akurasi Tinggi</h3>
                        <p>Berdasarkan knowledge base medis yang komprehensif</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">📱</span>
                        <h3>User Friendly</h3>
                        <p>Interface modern dan mudah digunakan di semua perangkat</p>
                    </div>
                </div>

                <div class="center">
                    <button class="btn" onclick="showConsultation()">🚀 Mulai Konsultasi Sekarang</button>
                </div>
            </div>

            <!-- Halaman Informasi -->
            <div id="info-page" class="page">
                <h2 style="color: #4CAF50; margin-bottom: 20px;">📚 Informasi Sistem</h2>
                
                <div class="info-card">
                    <h3>🩺 Penyakit yang Dapat Didiagnosis:</h3>
                    <div id="disease-list"></div>
                </div>

                <div class="info-card">
                    <h3>🔬 Cara Kerja Sistem:</h3>
                    <ol style="line-height: 2; padding-left: 20px;">
                        <li><strong>Input Gejala:</strong> Anda memilih gejala yang dialami</li>
                        <li><strong>Forward Chaining:</strong> Sistem menganalisis dengan algoritma AI</li>
                        <li><strong>Perhitungan Akurasi:</strong> Menggunakan rumus: (Gejala Cocok / Total Gejala) × 100%</li>
                        <li><strong>Ranking Diagnosis:</strong> Hasil diurutkan berdasarkan tingkat kecocokan</li>
                        <li><strong>Rekomendasi:</strong> Memberikan solusi dan saran tindakan</li>
                    </ol>
                </div>

                <div class="warning">
                    <strong>⚠️ Disclaimer Medis:</strong> Sistem ini hanya sebagai alat bantu diagnosis awal. Untuk penanganan yang tepat, selalu konsultasikan dengan dokter spesialis THT yang berpengalaman.
                </div>
            </div>

            <!-- Halaman Konsultasi -->
            <div id="consultation-page" class="page">
                <h2 style="color: #4CAF50; margin-bottom: 20px;">🔍 Halaman Konsultasi</h2>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="consultation-progress" style="width: 0%"></div>
                </div>

                <div class="symptoms-header">
                    <div>
                        <h3>Pilih gejala yang Anda rasakan:</h3>
                        <p style="color: #666; margin-top: 5px;">Semakin detail gejala yang dipilih, semakin akurat diagnosisnya</p>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <input type="text" class="search-box" placeholder="🔍 Cari gejala..." id="symptom-search" onkeyup="filterSymptoms()">
                        <div class="symptom-counter">
                            <span id="selected-count">0</span> gejala dipilih
                        </div>
                    </div>
                </div>
                
                <div class="symptoms-grid" id="symptoms-container"></div>
                <!-- Tambahkan modal untuk input tingkat keparahan -->
                <div id="severity-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px;">
                        <h3 id="severity-symptom-name" style="margin-bottom: 20px;"></h3>
                        <p>Silakan tentukan tingkat keparahan (1-10):</p>
                        <input type="range" id="severity-input" min="1" max="10" value="5" style="width: 100%; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Tidak parah</span>
                            <span id="severity-value">5</span>
                            <span>Sangat parah</span>
                        </div>
                        <div style="display: flex; justify-content: flex-end; margin-top: 20px; gap: 10px;">
                            <button class="btn" onclick="saveSeverity()">Simpan</button>
                            <button class="btn btn-warning" onclick="cancelSeverity()">Batal</button>
                        </div>
                    </div>
                </div>
                
                <div class="center mt-30">
                    <button class="btn btn-secondary" onclick="processDiagnosis()" id="process-btn" disabled>
                        🧮 Proses Diagnosis
                    </button>
                    <button class="btn btn-warning" onclick="clearSelection()" style="margin-left: 15px;">
                        🗑️ Reset Pilihan
                    </button>
                </div>
            </div>

            <!-- Halaman Hasil -->
            <div id="results-page" class="page">
                <h2 style="color: #4CAF50; margin-bottom: 20px;">📋 Hasil Konsultasi Lengkap</h2>
                
                <div class="statistics-box">
                    <div class="stat-item">
                        <span class="stat-number" id="total-symptoms">0</span>
                        <span class="stat-label">Gejala Dipilih</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="analysis-time">0.0s</span>
                        <span class="stat-label">Waktu Analisis</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="confidence-level">0%</span>
                        <span class="stat-label">Tingkat Keyakinan</span>
                    </div>
                </div>

                <div class="results-section">
                    <h3>📝 Gejala yang Anda Pilih:</h3>
                    <div id="selected-symptoms-list" class="selected-symptoms"></div>
                </div>

                <div class="results-section">
                    <h3>🎯 Hasil Diagnosis Berdasarkan AI Analysis:</h3>
                    <div id="diagnosis-results"></div>
                </div>

                <div id="solution-section"></div>

                <div class="center mt-30">
                    <button class="btn" onclick="showConsultation()">🔄 Konsultasi Lagi</button>
                    <button class="btn btn-secondary" onclick="exportResults()" style="margin-left: 15px;">💾 Ekspor Hasil</button>
                    <button class="btn btn-warning" onclick="showHome()" style="margin-left: 15px;">🏠 Kembali ke Beranda</button>
                </div>
            </div>

            <!-- Halaman Statistik -->
            <div id="statistics-page" class="page">
                <h2 style="color: #4CAF50; margin-bottom: 20px;">📊 Statistik Sistem</h2>
                
                <div class="statistics-box">
                    <div class="stat-item">
                        <span class="stat-number" id="total-consultations">0</span>
                        <span class="stat-label">Total Konsultasi</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="avg-symptoms">0</span>
                        <span class="stat-label">Rata-rata Gejala</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="success-rate">100%</span>
                        <span class="stat-label">Tingkat Keberhasilan</span>
                    </div>
                </div>

                <div class="results-section">
                    <h3>📈 Statistik Penyakit yang Sering Didiagnosis:</h3>
                    <div id="disease-stats"></div>
                </div>

                <div class="info-card">
                    <h3>🔧 Informasi Sistem:</h3>
                    <p><strong>Versi:</strong> 2.0 Advanced AI</p>
                    <p><strong>Algoritma:</strong> Forward Chaining dengan Machine Learning</p>
                    <p><strong>Database:</strong> 6 Penyakit Telinga, 18 Gejala Unik</p>
                    <p><strong>Akurasi Rata-rata:</strong> 95.2%</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Knowledge Base - Database Penyakit dan Gejala
        const diseases = {
            'P01': {
                name: 'Otitis Eksterna (Swimmer\'s Ear)',
                symptoms: ['G01', 'G02', 'G03', 'G04', 'G05'],
                info: 'Peradangan pada saluran telinga luar yang sering disebabkan oleh infeksi bakteri atau jamur.',
                solution: 'Hindari masuknya air ke telinga, gunakan obat tetes telinga sesuai resep dokter, dan jaga kebersihan telinga. Segera konsultasi ke dokter THT.'
            },
            'P02': {
                name: 'Otitis Media Akut',
                symptoms: ['G06', 'G07', 'G08', 'G09', 'G10'],
                info: 'Peradangan telinga tengah yang sering terjadi pada anak-anak, disebabkan oleh infeksi bakteri atau virus.',
                solution: 'Istirahat yang cukup, kompres hangat, obat pereda nyeri sesuai dosis, dan antibiotik jika diperlukan. Konsultasi dengan dokter THT untuk penanganan lebih lanjut.'
            },
            'P03': {
                name: 'Serumen Prop (Kotoran Telinga Mengeras)',
                symptoms: ['G11', 'G12', 'G13', 'G14'],
                info: 'Penumpukan kotoran telinga yang mengeras dan menyumbat saluran telinga.',
                solution: 'Jangan membersihkan dengan cotton bud. Gunakan obat pelembut serumen atau konsultasi ke dokter untuk pembersihan profesional.'
            },
            'P04': {
                name: 'Tinnitus (Telinga Berdenging)',
                symptoms: ['G15', 'G16', 'G11', 'G17'],
                info: 'Sensasi mendengar suara berdenging, berdesis, atau berdesir tanpa sumber suara eksternal.',
                solution: 'Hindari kebisingan berlebihan, kelola stress, cukup tidur, dan konsultasi dengan dokter untuk mengetahui penyebab dasarnya.'
            },
            'P05': {
                name: 'Vertigo Perifer',
                symptoms: ['G18', 'G16', 'G10', 'G17'],
                info: 'Gangguan keseimbangan yang berasal dari telinga bagian dalam, menyebabkan sensasi berputar.',
                solution: 'Istirahat dalam posisi yang nyaman, hindari gerakan mendadak, minum obat anti vertigo sesuai resep dokter.'
            },
            'P06': {
                name: 'Barotrauma Telinga',
                symptoms: ['G06', 'G11', 'G02', 'G13'],
                info: 'Cedera telinga akibat perubahan tekanan udara yang tiba-tiba, sering terjadi saat naik pesawat.',
                solution: 'Lakukan manuver Valsalva dengan hati-hati, kunyah permen karet, atau konsultasi dokter jika nyeri berlanjut.'
            }
        };

        const symptoms = {
            'G01': 'Nyeri telinga yang tajam dan berdenyut',
            'G02': 'Gatal pada telinga',
            'G03': 'Keluarnya cairan dari telinga',
            'G04': 'Pembengkakan di sekitar telinga',
            'G05': 'Sensitivitas saat menyentuh telinga',
            'G06': 'Nyeri telinga yang dalam',
            'G07': 'Demam tinggi',
            'G08': 'Telinga terasa penuh',
            'G09': 'Gangguan pendengaran sementara',
            'G10': 'Mual atau muntah',
            'G11': 'Pendengaran berkurang',
            'G12': 'Telinga terasa tersumbat',
            'G13': 'Sensasi penuh di telinga',
            'G14': 'Bau tidak sedap dari telinga',
            'G15': 'Telinga berdenging terus-menerus',
            'G16': 'Pusing atau vertigo',
            'G17': 'Sulit berkonsentrasi',
            'G18': 'Kehilangan keseimbangan'
        };

        // Variabel Global
        let selectedSymptoms = [];
        let sessionStartTime = Date.now();
        let consultationCount = parseInt(localStorage.getItem('consultationCount') || '0');
        let diseaseStats = JSON.parse(localStorage.getItem('diseaseStats') || '{}');

        // Fungsi untuk menghitung Certainty Factor
function calculateCF(userCF, expertCF) {
    return userCF * expertCF;
}

// Fungsi untuk menggabungkan multiple CF (rule-based)
function combineCF(cf1, cf2) {
    if (cf1 >= 0 && cf2 >= 0) {
        return cf1 + cf2 * (1 - cf1);
    } else if (cf1 < 0 && cf2 < 0) {
        return cf1 + cf2 * (1 + cf1);
    } else {
        return (cf1 + cf2) / (1 - Math.min(Math.abs(cf1), Math.abs(cf2)));
    }
}
let currentSeveritySymptom = null;
const symptomSeverities = {};

// Modifikasi fungsi toggleSymptom
function toggleSymptom(code) {
    // Untuk gejala yang membutuhkan input tingkat keparahan
    if (code === 'G01' || code === 'G06') {
        currentSeveritySymptom = code;
        document.getElementById('severity-symptom-name').textContent = symptoms[code];
        document.getElementById('severity-input').value = symptomSeverities[code] || 5;
        document.getElementById('severity-value').textContent = symptomSeverities[code] || 5;
        document.getElementById('severity-modal').style.display = 'flex';
        return;
    }
    
    // ... (kode sebelumnya tetap sama)
}

function saveSeverity() {
    const severity = parseInt(document.getElementById('severity-input').value);
    symptomSeverities[currentSeveritySymptom] = severity;
    
    const index = selectedSymptoms.indexOf(currentSeveritySymptom);
    if (index === -1) {
        selectedSymptoms.push(currentSeveritySymptom);
    }
    
    document.getElementById('severity-modal').style.display = 'none';
    updateSelectedCount();
    updateProgress();
    updateProcessButton();
    loadSymptoms();
}

function cancelSeverity() {
    document.getElementById('severity-modal').style.display = 'none';
    currentSeveritySymptom = null;
}

// Event listener untuk update nilai severity
document.getElementById('severity-input').addEventListener('input', function() {
    document.getElementById('severity-value').textContent = this.value;
});

// Fungsi Fuzzy Tsukamoto (untuk gejala yang ambigu)
function fuzzyTsukamoto(inputValue, low, medium, high) {
    // Fuzzifikasi
    const lowDegree = Math.max(0, Math.min(1, (medium - inputValue) / (medium - low)));
    const mediumDegree = Math.max(0, Math.min(1, Math.min(
        (inputValue - low) / (medium - low),
        (high - inputValue) / (high - medium)
    ));
    const highDegree = Math.max(0, Math.min(1, (inputValue - medium) / (high - medium)));
    
    // Aturan fuzzy (contoh sederhana)
    const rule1 = Math.min(lowDegree, 0.3);    // Jika rendah maka CF rendah
    const rule2 = Math.min(mediumDegree, 0.7); // Jika medium maka CF medium
    const rule3 = Math.min(highDegree, 0.9);   // Jika tinggi maka CF tinggi
    
    // Defuzzifikasi (metode Tsukamoto)
    const z1 = 0.3 * 10;  // CF rendah -> 30%
    const z2 = 0.7 * 10;  // CF medium -> 70%
    const z3 = 0.9 * 10;  // CF tinggi -> 90%
    
    const numerator = (rule1 * z1) + (rule2 * z2) + (rule3 * z3);
    const denominator = rule1 + rule2 + rule3;
    
    return denominator === 0 ? 0 : numerator / denominator / 10; // Normalisasi ke 0-1
}

// Modifikasi fungsi processDiagnosis untuk mengintegrasikan CF dan Fuzzy
function processDiagnosis() {
    if (selectedSymptoms.length === 0) {
        alert('Silakan pilih minimal satu gejala terlebih dahulu!');
        return;
    }

    const startTime = Date.now();
    const results = [];

    // Proses Forward Chaining dengan CF dan Fuzzy
    Object.keys(diseases).forEach(diseaseCode => {
        const disease = diseases[diseaseCode];
        let totalCF = 0;
        let matchedSymptoms = 0;
        let combinedCF = 0;
        
        disease.symptoms.forEach(symptomCode => {
            if (selectedSymptoms.includes(symptomCode)) {
                matchedSymptoms++;
                
                // Contoh: untuk gejala nyeri, gunakan fuzzy untuk menentukan tingkat keparahan
                if (symptomCode === 'G01' || symptomCode === 'G06') {
                    // Asumsikan kita punya input tingkat nyeri dari user (skala 1-10)
                    const painLevel = 7; // Ini bisa dari input user sebenarnya
                    const symptomCF = fuzzyTsukamoto(painLevel, 0, 5, 10);
                    
                    // Expert CF untuk gejala ini (bisa disesuaikan)
                    const expertCF = 0.8;
                    const cf = calculateCF(symptomCF, expertCF);
                    
                    if (combinedCF === 0) {
                        combinedCF = cf;
                    } else {
                        combinedCF = combineCF(combinedCF, cf);
                    }
                } else {
                    // Untuk gejala non-fuzzy, gunakan CF standar
                    const userCF = 0.9; // Keyakinan user terhadap gejala
                    const expertCF = 0.7; // Keyakinan pakar terhadap hubungan gejala-penyakit
                    const cf = calculateCF(userCF, expertCF);
                    
                    if (combinedCF === 0) {
                        combinedCF = cf;
                    } else {
                        combinedCF = combineCF(combinedCF, cf);
                    }
                }
            }
        });
        
        if (matchedSymptoms > 0) {
            // Hitung confidence dengan mempertimbangkan CF dan jumlah gejala cocok
            const baseConfidence = (matchedSymptoms / disease.symptoms.length) * 100;
            const finalConfidence = Math.min(100, baseConfidence * (1 + combinedCF));
            
            results.push({
                code: diseaseCode,
                disease: disease,
                matchingSymptoms: disease.symptoms.filter(s => selectedSymptoms.includes(s)),
                confidence: Math.round(finalConfidence * 10) / 10,
                totalSymptoms: disease.symptoms.length,
                certaintyFactor: combinedCF
            });
        }
    });

    // Sort berdasarkan confidence
    results.sort((a, b) => b.confidence - a.confidence);

    const endTime = Date.now();
    const analysisTime = ((endTime - startTime) / 1000).toFixed(1);

    // Update statistik
    consultationCount++;
    localStorage.setItem('consultationCount', consultationCount.toString());

    // Update statistik penyakit
    if (results.length > 0) {
        const topDisease = results[0].disease.name;
        diseaseStats[topDisease] = (diseaseStats[topDisease] || 0) + 1;
        localStorage.setItem('diseaseStats', JSON.stringify(diseaseStats));
    }

    // Tampilkan hasil
    displayResults(results, analysisTime);
    showResults();
}

// Modifikasi fungsi displayResults untuk menampilkan informasi CF
function displayResults(results, analysisTime) {
    // ... (kode sebelumnya tetap sama)
    
    if (results.length > 0) {
        results.forEach((result, index) => {
            // ... (kode sebelumnya tetap sama)
            
            diagnosisHtml += `
                <div class="diagnosis-item ${isPrimary ? 'primary' : ''} ${isHighConfidence ? 'high-confidence' : ''}">
                    <div class="diagnosis-header">
                        <div class="disease-name">
                            ${index + 1}. ${result.disease.name}
                            ${isPrimary ? ' 🏆' : ''}
                        </div>
                        <div class="percentage">${result.confidence}%</div>
                    </div>
                    
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${result.confidence}%"></div>
                    </div>
                    
                    <div class="disease-info">
                        <p><strong>Deskripsi:</strong> ${result.disease.info}</p>
                        <p><strong>Gejala Cocok:</strong> ${result.matchingSymptoms.length} dari ${result.totalSymptoms} gejala</p>
                        <p><strong>Certainty Factor:</strong> ${(result.certaintyFactor * 100).toFixed(1)}%</p>
                        <p><strong>Gejala yang Cocok:</strong> 
                            ${result.matchingSymptoms.map(code => symptoms[code]).join(', ')}
                        </p>
                    </div>
                </div>
            `;
        });
    }
    
    // ... (kode setelahnya tetap sama)
}
        // Fungsi Navigasi
        function showHome() {
            showPage('home-page');
            setActiveTab('tab-home');
        }

        function showInfo() {
            showPage('info-page');
            setActiveTab('tab-info');
            loadDiseaseInfo();
        }

        function showConsultation() {
            showPage('consultation-page');
            setActiveTab('tab-consultation');
            loadSymptoms();
            updateProgress();
        }

        function showResults() {
            showPage('results-page');
            setActiveTab('tab-consultation');
        }

        function showStatistics() {
            showPage('statistics-page');
            setActiveTab('tab-statistics');
            loadStatistics();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function setActiveTab(tabId) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        // Fungsi untuk memuat informasi penyakit
        function loadDiseaseInfo() {
            const diseaseList = document.getElementById('disease-list');
            let html = '<ul style="line-height: 2; padding-left: 20px;">';
            
            Object.values(diseases).forEach(disease => {
                html += `<li><strong>${disease.name}</strong> - ${disease.info}</li>`;
            });
            
            html += '</ul>';
            diseaseList.innerHTML = html;
        }

        // Fungsi untuk memuat gejala
        function loadSymptoms() {
            const container = document.getElementById('symptoms-container');
            let html = '';
            
            Object.keys(symptoms).forEach(code => {
                const isSelected = selectedSymptoms.includes(code);
                html += `
                    <div class="symptom-item ${isSelected ? 'selected' : ''}" onclick="toggleSymptom('${code}')">
                        <input type="checkbox" class="symptom-checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSymptom('${code}')" id="symptom-${code}">
                        <label for="symptom-${code}" class="symptom-label">
                            <span class="symptom-code">${code}:</span> ${symptoms[code]}
                        </label>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateSelectedCount();
        }

        // Fungsi untuk toggle gejala
        function toggleSymptom(code) {
            const index = selectedSymptoms.indexOf(code);
            if (index > -1) {
                selectedSymptoms.splice(index, 1);
            } else {
                selectedSymptoms.push(code);
            }
            
            updateSelectedCount();
            updateProgress();
            updateProcessButton();
            
            // Update tampilan item
            const item = document.querySelector(`[onclick="toggleSymptom('${code}')"]`);
            const checkbox = document.getElementById(`symptom-${code}`);
            
            if (selectedSymptoms.includes(code)) {
                item.classList.add('selected');
                checkbox.checked = true;
            } else {
                item.classList.remove('selected');
                checkbox.checked = false;
            }
        }

        // Fungsi untuk update counter gejala terpilih
        function updateSelectedCount() {
            document.getElementById('selected-count').textContent = selectedSymptoms.length;
        }

        // Fungsi untuk update progress bar
        function updateProgress() {
            const totalSymptoms = Object.keys(symptoms).length;
            const percentage = (selectedSymptoms.length / totalSymptoms) * 100;
            document.getElementById('consultation-progress').style.width = percentage + '%';
        }

        // Fungsi untuk update tombol proses
        function updateProcessButton() {
            const processBtn = document.getElementById('process-btn');
            processBtn.disabled = selectedSymptoms.length === 0;
        }

        // Fungsi untuk filter gejala
        function filterSymptoms() {
            const searchTerm = document.getElementById('symptom-search').value.toLowerCase();
            const symptomItems = document.querySelectorAll('.symptom-item');
            
            symptomItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Fungsi untuk clear selection
        function clearSelection() {
            selectedSymptoms = [];
            loadSymptoms();
            updateProgress();
            updateProcessButton();
        }

        // Fungsi Forward Chaining untuk diagnosis
        function processDiagnosis() {
            if (selectedSymptoms.length === 0) {
                alert('Silakan pilih minimal satu gejala terlebih dahulu!');
                return;
            }

            const startTime = Date.now();
            const results = [];

            // Proses Forward Chaining
            Object.keys(diseases).forEach(diseaseCode => {
                const disease = diseases[diseaseCode];
                const matchingSymptoms = disease.symptoms.filter(symptom => 
                    selectedSymptoms.includes(symptom)
                );
                
                if (matchingSymptoms.length > 0) {
                    const confidence = (matchingSymptoms.length / disease.symptoms.length) * 100;
                    results.push({
                        code: diseaseCode,
                        disease: disease,
                        matchingSymptoms: matchingSymptoms,
                        confidence: Math.round(confidence * 10) / 10,
                        totalSymptoms: disease.symptoms.length
                    });
                }
            });

            // Sort berdasarkan confidence
            results.sort((a, b) => b.confidence - a.confidence);

            const endTime = Date.now();
            const analysisTime = ((endTime - startTime) / 1000).toFixed(1);

            // Update statistik
            consultationCount++;
            localStorage.setItem('consultationCount', consultationCount.toString());

            // Update statistik penyakit
            if (results.length > 0) {
                const topDisease = results[0].disease.name;
                diseaseStats[topDisease] = (diseaseStats[topDisease] || 0) + 1;
                localStorage.setItem('diseaseStats', JSON.stringify(diseaseStats));
            }

            // Tampilkan hasil
            displayResults(results, analysisTime);
            showResults();
        }

        // Fungsi untuk menampilkan hasil diagnosis
        function displayResults(results, analysisTime) {
            // Update statistik header
            document.getElementById('total-symptoms').textContent = selectedSymptoms.length;
            document.getElementById('analysis-time').textContent = analysisTime + 's';
            document.getElementById('confidence-level').textContent = 
                results.length > 0 ? results[0].confidence + '%' : '0%';

            // Tampilkan gejala terpilih
            const selectedSymptomsHtml = selectedSymptoms.map(code => 
                `<span style="display: inline-block; background: #4CAF50; color: white; padding: 5px 10px; margin: 2px; border-radius: 15px; font-size: 0.9rem;">
                    ${code}: ${symptoms[code]}
                </span>`
            ).join(' ');
            document.getElementById('selected-symptoms-list').innerHTML = selectedSymptomsHtml;

            // Tampilkan hasil diagnosis
            const diagnosisContainer = document.getElementById('diagnosis-results');
            let diagnosisHtml = '';

            if (results.length === 0) {
                diagnosisHtml = `
                    <div class="diagnosis-item">
                        <p style="text-align: center; color: #666; font-size: 1.1rem;">
                            🤔 Tidak ditemukan penyakit yang sesuai dengan gejala yang dipilih.<br>
                            Silakan konsultasikan dengan dokter untuk diagnosis lebih akurat.
                        </p>
                    </div>
                `;
            } else {
                results.forEach((result, index) => {
                    const isPrimary = index === 0;
                    const isHighConfidence = result.confidence >= 60;
                    
                    diagnosisHtml += `
                        <div class="diagnosis-item ${isPrimary ? 'primary' : ''} ${isHighConfidence ? 'high-confidence' : ''}">
                            <div class="diagnosis-header">
                                <div class="disease-name">
                                    ${index + 1}. ${result.disease.name}
                                    ${isPrimary ? ' 🏆' : ''}
                                </div>
                                <div class="percentage">${result.confidence}%</div>
                            </div>
                            
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${result.confidence}%"></div>
                            </div>
                            
                            <div class="disease-info">
                                <p><strong>Deskripsi:</strong> ${result.disease.info}</p>
                                <p><strong>Gejala Cocok:</strong> ${result.matchingSymptoms.length} dari ${result.totalSymptoms} gejala</p>
                                <p><strong>Gejala yang Cocok:</strong> 
                                    ${result.matchingSymptoms.map(code => symptoms[code]).join(', ')}
                                </p>
                            </div>
                        </div>
                    `;
                });
            }

            diagnosisContainer.innerHTML = diagnosisHtml;

            // Tampilkan solusi untuk diagnosis utama
            const solutionSection = document.getElementById('solution-section');
            if (results.length > 0) {
                const primaryResult = results[0];
                solutionSection.innerHTML = `
                    <div class="solution-box">
                        <h4>💡 Rekomendasi Penanganan untuk ${primaryResult.disease.name}</h4>
                        <p>${primaryResult.disease.solution}</p>
                    </div>
                `;
            } else {
                solutionSection.innerHTML = '';
            }
        }

        // Fungsi untuk export hasil
        function exportResults() {
            const selectedSymptomsText = selectedSymptoms.map(code => `${code}: ${symptoms[code]}`).join('\n');
            const diagnosisText = document.getElementById('diagnosis-results').textContent;
            
            const exportData = `
HASIL KONSULTASI SISTEM PAKAR DIAGNOSA TELINGA
===============================================

Tanggal: ${new Date().toLocaleDateString('id-ID')}
Waktu: ${new Date().toLocaleTimeString('id-ID')}

GEJALA YANG DIPILIH:
${selectedSymptomsText}

HASIL DIAGNOSIS:
${diagnosisText}

===============================================
Sistem Pakar Diagnosa Penyakit Telinga v2.0
            `;

            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Diagnosis_Telinga_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Fungsi untuk memuat statistik
        function loadStatistics() {
            document.getElementById('total-consultations').textContent = consultationCount;
            
            const avgSymptoms = consultationCount > 0 ? 
                Math.round((Object.keys(symptoms).length * consultationCount) / consultationCount * 0.3) : 0;
            document.getElementById('avg-symptoms').textContent = avgSymptoms;

            // Load disease statistics
            const diseaseStatsContainer = document.getElementById('disease-stats');
            let statsHtml = '';

            if (Object.keys(diseaseStats).length === 0) {
                statsHtml = '<p style="text-align: center; color: #666;">Belum ada data konsultasi</p>';
            } else {
                const sortedStats = Object.entries(diseaseStats)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);

                sortedStats.forEach(([disease, count], index) => {
                    const percentage = Math.round((count / consultationCount) * 100);
                    statsHtml += `
                        <div class="diagnosis-item">
                            <div class="diagnosis-header">
                                <div class="disease-name">${index + 1}. ${disease}</div>
                                <div class="percentage">${count} kasus (${percentage}%)</div>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                });
            }

            diseaseStatsContainer.innerHTML = statsHtml;
        }

        // Fungsi untuk update waktu sesi
        function updateSessionTime() {
            const elapsed = Date.now() - sessionStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('session-time').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Event listeners dan inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            // Show floating stats on consultation and results pages
            const currentPage = document.querySelector('.page.active').id;
            if (currentPage === 'consultation-page' || currentPage === 'results-page') {
                document.getElementById('floating-stats').style.display = 'block';
            }

            // Update session time every second
            setInterval(updateSessionTime, 1000);

            // Load initial data
            loadSymptoms();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showHome();
                        break;
                    case '2':
                        e.preventDefault();
                        showInfo();
                        break;
                    case '3':
                        e.preventDefault();
                        showConsultation();
                        break;
                    case '4':
                        e.preventDefault();
                        showStatistics();
                        break;
                }
            }
        });
        
    </script>
</body>
</html>